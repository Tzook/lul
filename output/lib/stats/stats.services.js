'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const master_services_1 = require("../master/master.services");
let config = require('../../../server/lib/stats/stats.config.json');
const _ = require("underscore");
class StatsServices extends master_services_1.default {
    magToMp(mag) {
        return mag * config.MAG_TO_MP_RATIO;
    }
    strToHp(str) {
        return str * config.STR_TO_HP_RATIO;
    }
    getExp(level) {
        return Math.round(this.getAbsoluteExp(level + 1) - this.getAbsoluteExp(level));
    }
    getAbsoluteExp(a) {
        return (50 / 3) * (a * a * a - 6 * a * a + 17 * a - 12);
    }
    lvlUp(socket) {
        let stats = socket.character.stats;
        stats.lvl++;
        let str, dex, mag;
        str = dex = mag = config.LEVEL_UP_STAT_BONUS;
        this.addStr(stats, str);
        this.addMag(stats, mag);
        this.addDex(stats, dex);
        stats.hp.now = socket.maxHp;
        stats.mp.now = socket.maxMp;
        console.log("Level up", stats);
    }
    addStr(stats, str) {
        stats.str += str;
        this.addHp(stats, this.strToHp(str));
    }
    addMag(stats, mag) {
        stats.mag += mag;
        this.addMp(stats, this.magToMp(mag));
    }
    addDex(stats, dex) {
        stats.dex += dex;
    }
    addHp(stats, hp) {
        stats.hp.total += hp;
    }
    addMp(stats, mp) {
        stats.mp.total += mp;
    }
    getHpAfterDamage(hp, dmg) {
        return Math.max(0, Math.floor(hp - dmg));
    }
}
exports.default = StatsServices;
;
StatsServices.prototype.getExp = _.memoize(StatsServices.prototype.getExp);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHMuc2VydmljZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zZXJ2ZXIvbGliL3N0YXRzL3N0YXRzLnNlcnZpY2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7QUFDYiwrREFBdUQ7QUFDdkQsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7QUFDcEUsZ0NBQWdDO0FBRWhDLG1CQUFtQyxTQUFRLHlCQUFjO0lBQzlDLE9BQU8sQ0FBQyxHQUFXO1FBQ3RCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQztJQUN4QyxDQUFDO0lBRU0sT0FBTyxDQUFDLEdBQVc7UUFDdEIsTUFBTSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsZUFBZSxDQUFDO0lBQ3hDLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBYTtRQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDbkYsQ0FBQztJQUVTLGNBQWMsQ0FBQyxDQUFTO1FBRTlCLE1BQU0sQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVNLEtBQUssQ0FBQyxNQUFrQjtRQUMzQixJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztRQUNuQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFWixJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO1FBQ2xCLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQztRQUM3QyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztRQUN4QixLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQzVCLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFFNUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVNLE1BQU0sQ0FBQyxLQUFZLEVBQUUsR0FBVztRQUNuQyxLQUFLLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUNNLE1BQU0sQ0FBQyxLQUFZLEVBQUUsR0FBVztRQUNuQyxLQUFLLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUNNLE1BQU0sQ0FBQyxLQUFZLEVBQUUsR0FBVztRQUNuQyxLQUFLLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQztJQUNyQixDQUFDO0lBQ00sS0FBSyxDQUFDLEtBQVksRUFBRSxFQUFVO1FBQ2pDLEtBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBQ00sS0FBSyxDQUFDLEtBQVksRUFBRSxFQUFVO1FBQ2pDLEtBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRUcsZ0JBQWdCLENBQUMsRUFBVSxFQUFFLEdBQVc7UUFDOUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDMUMsQ0FBQztDQUNEO0FBdERELGdDQXNEQztBQUFBLENBQUM7QUFFRixhQUFhLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBUSxDQUFDLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMifQ==