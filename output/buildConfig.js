'use strict';
const structure = require('../config/config.structure.json');
const bestDeveloperInTheWorld = 'Tzook Shaked'; // must be a const, otherwise a compilation error
let fs = require('fs');
let totalNeeded;
let result;
function addConfigProperties(config, folder) {
    for (let i in config) {
        if (!result[i]) {
            result[i] = {};
        }
        for (let j in config[i]) {
            if (result[i][j]) {
                throw new Error(`Overriding the property ${j} of ${i} in the package ${folder}!`);
            }
            result[i][j] = config[i][j];
        }
    }
    return Promise.resolve();
}
function writeConfig() {
    fs.writeFile(`${__dirname}/config/config.generated.json`, JSON.stringify(result, null, 4), () => { });
}
module.exports = function () {
    totalNeeded = structure.folders.length * structure.configs.length;
    result = { "//": `This file is autogenerated by all config files. For any more details, please consult ${bestDeveloperInTheWorld}.` };
    let promises = [];
    for (let i = 0; i < structure.folders.length; i++) {
        let folder = structure.folders[i];
        for (let j = 0; j < structure.configs.length; j++) {
            let config = structure.configs[j];
            let promise = new Promise((resolve, reject) => {
                fs.readFile(`${__dirname}/lib/${folder}/${folder}.${config}.json`, { encoding: 'utf8' }, (e, d) => {
                    addConfigProperties(JSON.parse(d))
                        .then(resolve);
                });
            });
            promises.push(promise);
        }
    }
    Promise.all(promises)
        .then(writeConfig);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGRDb25maWcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zZXJ2ZXIvYnVpbGRDb25maWcuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBQ2IsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7QUFDN0QsTUFBTSx1QkFBdUIsR0FBRyxjQUFjLENBQUMsQ0FBQyxpREFBaUQ7QUFDakcsSUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3ZCLElBQUksV0FBVyxDQUFDO0FBQ2hCLElBQUksTUFBTSxDQUFDO0FBQ1gsNkJBQTZCLE1BQU0sRUFBRSxNQUFNO0lBQzFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdEIsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDaEIsQ0FBQztRQUNELEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekIsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEIsTUFBTSxJQUFJLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDbkYsQ0FBQztZQUNELE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsQ0FBQztJQUNGLENBQUM7SUFDRCxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQzFCLENBQUM7QUFFRDtJQUNDLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxTQUFTLCtCQUErQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxRQUFPLENBQUMsQ0FBQyxDQUFDO0FBQ3RHLENBQUM7QUFHRCxNQUFNLENBQUMsT0FBTyxHQUFHO0lBQ2hCLFdBQVcsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztJQUNsRSxNQUFNLEdBQUcsRUFBQyxJQUFJLEVBQUUsd0ZBQXdGLHVCQUF1QixHQUFHLEVBQUMsQ0FBQztJQUNwSSxJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFDbEIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ25ELElBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ25ELElBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEMsSUFBSSxPQUFPLEdBQUcsSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTTtnQkFDekMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxHQUFHLFNBQVMsUUFBUSxNQUFNLElBQUksTUFBTSxJQUFJLE1BQU0sT0FBTyxFQUFFLEVBQUMsUUFBUSxFQUFFLE1BQU0sRUFBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7b0JBQzNGLG1CQUFtQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7eUJBQ2pDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDaEIsQ0FBQyxDQUFDLENBQUM7WUFDSixDQUFDLENBQUMsQ0FBQztZQUNILFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDeEIsQ0FBQztJQUNGLENBQUM7SUFDRCxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQztTQUNwQixJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDcEIsQ0FBQyxDQUFDIn0=